{% extends "admin/base_site.html" %} {% block content %}
<h1>Add Column to Schema: {{ schema.name }}</h1>

<form method="post" id="add-column-form">
  {% csrf_token %}

  <fieldset>{{ form.mode }}</fieldset>

  <fieldset id="template-section" style="display: none">
    <label for="id_template">Template:</label>
    <select name="template" id="id_template">
      {% for tpl in form.fields.template.queryset %}
      <option value="{{ tpl.pk }}" {% if tpl.is_used %}disabled{% endif %}>
        {{ tpl.title }}{% if tpl.is_used %} (already added){% endif %}
      </option>
      {% endfor %}
    </select>
  </fieldset>

  <fieldset id="custom-section" style="display: none">
    {{ form.title }} {{ form.data_type }}
  </fieldset>

  <button type="submit" class="default">Add Column</button>
</form>

<br />
<a href="{% url 'admin:schemas_schema_change' schema.pk %}">Back to Schema</a>

<script>
  const modeRadios = document.querySelectorAll('input[name="mode"]');
  const templateSection = document.getElementById("template-section");
  const customSection = document.getElementById("custom-section");

  function toggleSections() {
    const mode = document.querySelector('input[name="mode"]:checked').value;
    if (mode === "template") {
      templateSection.style.display = "block";
      customSection.style.display = "none";
    } else {
      templateSection.style.display = "none";
      customSection.style.display = "block";
    }
  }

  modeRadios.forEach((radio) =>
    radio.addEventListener("change", toggleSections)
  );
  toggleSections(); // Set initial state
</script>
{% endblock %}
